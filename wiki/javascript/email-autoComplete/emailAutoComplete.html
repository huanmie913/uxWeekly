<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>模仿新浪注册</title>
<style type="text/css">
	*{ margin:0; padding:0}
	li{ list-style:none}
	.e_box{ width:400px; margin:20px auto; font-family:"宋体"; font-size:14px; color:#666}
	.txtInput{ padding:4px 5px; width:200px;}
	.e_tip{ border-width:0 1px 1px; border-style:solid; border-color:#ccc; background:#fff; z-index:999; position:absolute; width: 212px; left: 792px; top: 46px;}
	.e_tip li{ color:#999; cursor:pointer; height:20px; font-size:12px; line-height:20px; padding:0 5px; margin:0 1px; white-space:nowrap; overflow:hidden}
	.e_tip li a{color:#999; text-decoration:none; display:block;}
	/*.e_tip li.on a:hover{ background:#bbb;}*/
	.e_tip li .cur_val{ background:#399; color:#000}
	
	.e_tip li.on a{ background:#F00}
	.xx{ border:1px solid #0F3}
	
</style>
</head>
<body>
<!--e_box-->
<div class="e_box">
	<label>电子邮箱:</label>
	<input value="" class="txtInput" id="email" autocomplete="off" type="text"/>
</div>
<!--/e_box-->
<!--e_tip-->
<div style="display: none;" class="e_tip" id="e_tip">
	<ul>
		<li class="" id="e_type">请选择邮箱类型:</li>
	</ul>
</div>
<!--/e_tip-->
<script type="text/javascript">
    (function(win,undefined){
	
	  /*email suffix*/
	  var suffixArr = new Array("@163.com", "@qq.com", "@126.com", "@hotmail.com", "@gmail.com", "@sohu.com", "@yahoo.com.cn", "@yahoo.com", "@sina.com", "@msn.com");
      
	  /*public object YJ*/
	  var YJ = YJ || {};
      YJ = {
		    G : function(id){
		        return typeof id == "string" ? document.getElementById(id) : id; 
		    },
			extend : function(destination,target){
				for( var prop in target ){
					destination[prop] = target[prop];
				}
				return destination;
			},
			getEvent : function(e){
				return e || window.event;
			},
			getTarget : function(e){
				return e.target || e.srcElement;
			},
			on : function(otarget,otype,fn){
				if( otarget.addEventListener ){
					otarget.addEventListener( otype,fn,false);
				}else if( otarget.attachEvent ){
					otarget.attachEvent( "on"+otype,function(){
						fn.call(otarget);
					})
				}else{
					otarget["on"+otype] = fn;
				}
			},
			each : function(object, callback, args){
				var name, i = 0,
					length = object.length,
					isObj = length === undefined || (Object.prototype.toString.call(object) == "[object Function]");
				if(args) {
					if(isObj){
						for (name in object){
							if(callback.apply(object[ name ], args  === false )){ break; }
						}
					}else{
						for( ; i < length; ){
							if( callback.apply( object[ i++ ], args ) === false ){ break; }
						}
					}
				}else{
					if(isObj){
						for (name in object){
							if(callback.call(object[ name ], name, object[ name ]) === false){ break; }
						}
					}else{
						for( ; i < length; ) {
							if( callback.call( object[ i ], i, object[ i++ ] ) === false){ break; }
						}
					}
				}
				return object;
			}
	  }
	  
	  /*emailAutoComplete*/
	  function emailAutoComplete(arg){
	      this.opt = {
		      subBox    : "e_tip",
			  tag       : "li",
			  id        : "email",
			  suffixArr : suffixArr ,
			  hoverClass: "on"
		  }
		  this.setting = YJ.extend(this.opt,arg || {});
		  this.curNum = 1;
		  this.configValue = {
			_emailId : null,
			_subBoxId : null
		  }
		  if( !(this instanceof emailAutoComplete)){
				return new emailAutoComplete(arg);
		  }
		  this.init();
	  }
	  emailAutoComplete.prototype = {
	      constructor : emailAutoComplete,
		  tipBox      : function(v,obj){
			var that = this;
			that.configValue._subBoxId.style.display = "block";
			var _str = '<ul>';
				_str += '<li id="e_type">请选择邮箱类型:</li><li><a href="javascript:void(0)" class="cur_val">'+v+'</a></li>';
			var e = v.indexOf("@");
			if( e == -1 ){
				YJ.each( that.setting.suffixArr,function(k,o){
					_str += '<li><a href="javascript:void(0)" id="e'+k+'">'+v+o+'</a></li>';
				})
			}else{
				var _sh = v.substring(0,e),
					_se = v.substring(e);
				YJ.each( that.setting.suffixArr,function(k,o){
					if( o.indexOf(_se)!=-1 ){
						_str+='<li><a href="javascript:void(0)" id="e'+k+'">'+_sh+o+'</a></li>';
					}
				})
			}
			_str +="</ul>";
			that.configValue._subBoxId.innerHTML = _str;
			var _li = that.configValue._subBoxId.getElementsByTagName( that.setting.tag );
			for( var i=_li.length-1;i>=0;i-- ){
				_li[i].onmouseover = (function(j){
					return function(){
						_li[j].className = that.setting.hoverClass;
					}
				})(i);
				
				_li[i].onmouseout = (function(j){
					return function(){
						_li[j].className = "";
					}
				})(i);
				
				_li[i].onclick = (function(j){
					return function(){
						if( _li[j].id !="e_type" ){
							that.configValue._emailId.value = /<a[^\/].*>(.*)<\/a>/gi.exec(_li[j].innerHTML)[1];;
							that.configValue._subBoxId.style.display = "none";
						}
					}
				})(i);
			}
		  },
		  dropList : function(){
			var that = this;
			var _li = that.configValue._subBoxId.getElementsByTagName( that.setting.tag ),
				_len = _li.length;
			for( var i=_len-1;i>=0;i--){
				_li[i].className ="";
			}
			if( _len>2 ){
				if( that.curNum > _len-1 ){
					that.curNum = 2;
				}
				if( that.curNum < 2 ){
					that.curNum = _len-1;
				}
				_li[that.curNum].className = that.setting.hoverClass;
			}else{
				that.curNum = 1;
			}
		  },
		  init : function(){
			var that = this;
			that.configValue._emailId = YJ.G( that.setting.id ),
			that.configValue._subBoxId = YJ.G( that.setting.subBox );
			
			YJ.on(that.configValue._emailId,"keyup",function(e){
				var _ev = YJ.getEvent(e);
				if( _ev.keyCode == 40 || _ev.keyCode == 38 ){
					return false;
				}
				if( this.value !="" ){
					if( _ev.keyCode != 38 && _ev.keyCode != 40 && _ev.keyCode !=13 && _ev.keyCode !=27 ){
						var _inputVal = this.value;
						that.tipBox(_inputVal,this);
					}
				}else{
					that.configValue._subBoxId.style.display = "none";
				}
			});
			
			YJ.on(document,"keydown",function(e){
				var _ev = YJ.getEvent(e);
				switch(_ev.keyCode){
					case 40:
						that.curNum++;
						that.dropList();
						break;
					case 38:
						that.curNum--;
						that.dropList();
						break;
					default:
						break;
				}
			});
			
			YJ.on(that.configValue._emailId,'keydown',function(e){
				var _li = that.configValue._subBoxId.getElementsByTagName( that.setting.tag ),
					_ev = YJ.getEvent(e);
				if(_ev.keyCode == 13){
					this.value = /<a[^\/].*>(.*)<\/a>/gi.exec(_li[that.curNum].innerHTML)[1];
					that.configValue._subBoxId.style.display = "none";
					that.curNum = 1;
				}
			});
			
		  }
	  }
	  win.emailAutoComplete = emailAutoComplete;
	})(window);
	
	emailAutoComplete();
</script>


</body></html>